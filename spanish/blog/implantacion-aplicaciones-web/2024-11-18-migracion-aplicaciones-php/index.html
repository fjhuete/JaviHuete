<!doctype html>
<html
  itemscope
  class=""
  lang="es-Es"
  itemtype="http://schema.org/WebPage">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    
    <meta charset="utf-8" />


<meta
  name="viewport"
  content="width=device-width, initial-scale=1, maximum-scale=5" />


<meta name="theme-name" content="hugoplate" />















<link rel="shortcut icon" href="/images/favicon_hu4028665881880111129.png" type="image/x-icon">
<link rel="icon" href="/images/favicon_hu4028665881880111129.png" type="image/x-icon">
<link rel="icon" type="image/png" sizes="48x48" href="/images/favicon_hu5217499384461932560.png">
<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon_hu4028665881880111129.png">
<link rel="apple-touch-icon" sizes="144x144" href="/images/favicon_hu2974018437732034086.png">








<link rel="manifest" href="/manifest.webmanifest" />
<meta
  name="msapplication-TileColor"
  content="#ddd" />
<meta
  name="theme-color"
  content="#ffffff" />






















  <base href="//localhost:1313/spanish/blog/implantacion-aplicaciones-web/2024-11-18-migracion-aplicaciones-php/" />







  


<title>Migración de aplicaciones web PHP al entorno de producción</title>















  <meta
    name="keywords"
    content="Boilerplate, Hugo" />




<meta
  name="description"
  content="Hugo &amp; Tailwindcss Starter" />



  <meta name="author" content="zeon.studio" />






  












  

  
  
  


  
  
    
    
      
    

    


    
    


    
    
      
      
      
        <meta property="og:image" content="//localhost:1313/images/og-image.png" />
        <meta name="twitter:image" content="//localhost:1313/images/og-image.png" />
        <meta
          name="twitter:card"
          content="summary_large_image" />
      
      
      <meta property="og:image:width" content="900" />
      <meta property="og:image:height" content="600" />
    


    
    <meta
      property="og:image:type"
      content="image/.png" />
  


  





<meta property="og:title" content="Migración de aplicaciones web PHP al entorno de producción" />
<meta property="og:description" content="Hugo &amp; Tailwindcss Starter" />
<meta property="og:type" content="website" />
<meta property="og:url" content="//localhost:1313/spanish/blog/implantacion-aplicaciones-web/2024-11-18-migracion-aplicaciones-php/" />


<meta name="twitter:title" content="Migración de aplicaciones web PHP al entorno de producción" />
<meta name="twitter:description" content="Hugo &amp; Tailwindcss Starter" />


  <meta name="twitter:site" content="@zeon_studio" />


  <meta name="twitter:creator" content="@zeon.studio" />



















<script>
  let indexURL = "//localhost:1313/searchindex.json";
  let includeSectionsInSearch = ["blog"];
  let search_no_results = "0 results for";
  let search_initial_message = "";
</script>























    
    
<meta http-equiv="x-dns-prefetch-control" content="on" />
<link rel="preconnect" href="https://use.fontawesome.com" crossorigin />
<link rel="preconnect" href="//cdnjs.cloudflare.com" />
<link rel="preconnect" href="//www.googletagmanager.com" />
<link rel="preconnect" href="//www.google-analytics.com" />
<link rel="dns-prefetch" href="https://use.fontawesome.com" />
<link rel="dns-prefetch" href="//ajax.googleapis.com" />
<link rel="dns-prefetch" href="//cdnjs.cloudflare.com" />
<link rel="dns-prefetch" href="//www.googletagmanager.com" />
<link rel="dns-prefetch" href="//www.google-analytics.com" />
<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//connect.facebook.net" />
<link rel="dns-prefetch" href="//platform.linkedin.com" />
<link rel="dns-prefetch" href="//platform.twitter.com" />




<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<script>
  (function () {
    const googleFont = document.createElement("link");
    googleFont.href = "https://fonts.googleapis.com/css2?family=Heebo:wght@400;600&family=Signika:wght@500;700&display=swap";
    googleFont.type = "text/css";
    googleFont.rel = "stylesheet";
    document.head.appendChild(googleFont);
  })();
</script>





  
    
      
    
  

  
    
      
    
  

  
    
      
    
  

  
    
      
    
  

  
    
      
    
  











  
  



<link
  href="/css/style.css"
  integrity=""
  rel="stylesheet" />


<link
  defer
  async
  rel="stylesheet"
  href="/css/style-lazy.css"
  integrity=""
  media="print"
  onload="this.media='all'; this.onload=null;" />


  </head>

  <body>
    
    
      





      
      <div
  class="fixed left-0 top-0 z-50 flex w-[30px] items-center justify-center bg-gray-200 py-[2.5px] text-[12px] uppercase text-black sm:bg-red-200 md:bg-yellow-200 lg:bg-green-200 xl:bg-blue-200 2xl:bg-pink-200">
  <span class="block sm:hidden">all</span>
  <span class="hidden sm:block md:hidden">sm</span>
  <span class="hidden md:block lg:hidden">md</span>
  <span class="hidden lg:block xl:hidden">lg</span>
  <span class="hidden xl:block 2xl:hidden">xl</span>
  <span class="hidden 2xl:block">2xl</span>
</div>

    


    
    





    
    <header
  class="header sticky top-0 z-30">
  <nav class="navbar container">
    
    <div class="order-0">
      
      <a class="navbar-brand block" href="/">
        















  









  
  
  


  
  
    
    
  


  
  
      
      
    
    
    
    
    
    
  
  

  
  
    
    
      
      


      
      
        
        
        
        

        
        
        
      
      
    
  
  

  
    <img
      fetchpriority="high"
      decoding="async"
      class="img img-light"
      width="160"
      height="32"
      src="/images/logo_hu4114262549785978686.webp"
      alt="Javi Huete"
      onerror="this.onerror=null;this.src='\/images\/logo_hu7137767845088484273.png';" />

    <img
      fetchpriority="high"
      decoding="async"
      class="img img-dark"
      width="160"
      height="32"
      src="/images/logo-darkmode_hu8742296558546396051.webp"
      alt="Javi Huete"
      onerror="this.onerror=null;this.src='\/images\/logo-darkmode_hu4471933895487503573.png';" />
  
  


      </a>
    </div>
    
    <input id="nav-toggle" type="checkbox" class="hidden" />
    <label
      for="nav-toggle"
      class="order-3 cursor-pointer flex items-center lg:hidden text-dark dark:text-white lg:order-1">
      <svg id="show-button" class="h-6 fill-current block" viewBox="0 0 20 20">
        <title>Menu Open</title>
        <path d="M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z"></path>
      </svg>
      <svg id="hide-button" class="h-6 fill-current hidden" viewBox="0 0 20 20">
        <title>Menu Close</title>
        <polygon
          points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2"
          transform="rotate(45 10 10)"></polygon>
      </svg>
    </label>
    

    
    <ul
      id="nav-menu"
      class="navbar-nav order-3 hidden lg:flex w-full pb-6 lg:order-1 lg:w-auto lg:space-x-2 lg:pb-0 xl:space-x-8">
      
      
      
    </ul>

    <div class="order-1 ml-auto flex items-center md:order-2 lg:ml-0">
      
        
          <button
            aria-label="search"
            
            class="border-border text-dark hover:text-primary dark:border-darkmode-border mr-5 inline-block border-r pr-5 text-xl dark:text-white dark:hover:text-darkmode-primary"
            
            data-target="search-modal">
            <i class="fa-solid fa-search"></i>
          </button>
        
      

      









      


  <div class="theme-switcher mr-5 hidden">
    <input id="theme-switcher" data-theme-switcher type="checkbox" />
    <label for="theme-switcher">
      <span class="sr-only">theme switcher</span>
      <span>
        
        <svg
          class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10 opacity-100 dark:opacity-0"
          viewBox="0 0 56 56"
          fill="#fff"
          height="16"
          width="16">
          <path
            d="M30 4.6c0-1-.9-2-2-2a2 2 0 0 0-2 2v5c0 1 .9 2 2 2s2-1 2-2Zm9.6 9a2 2 0 0 0 0 2.8c.8.8 2 .8 2.9 0L46 13a2 2 0 0 0 0-2.9 2 2 0 0 0-3 0Zm-26 2.8c.7.8 2 .8 2.8 0 .8-.7.8-2 0-2.9L13 10c-.7-.7-2-.8-2.9 0-.7.8-.7 2.1 0 3ZM28 16a12 12 0 0 0-12 12 12 12 0 0 0 12 12 12 12 0 0 0 12-12 12 12 0 0 0-12-12Zm23.3 14c1.1 0 2-.9 2-2s-.9-2-2-2h-4.9a2 2 0 0 0-2 2c0 1.1 1 2 2 2ZM4.7 26a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4.9c1 0 2-.9 2-2s-1-2-2-2Zm37.8 13.6a2 2 0 0 0-3 0 2 2 0 0 0 0 2.9l3.6 3.5a2 2 0 0 0 2.9 0c.8-.8.8-2.1 0-3ZM10 43.1a2 2 0 0 0 0 2.9c.8.7 2.1.8 3 0l3.4-3.5c.8-.8.8-2.1 0-2.9-.8-.8-2-.8-2.9 0Zm20 3.4c0-1.1-.9-2-2-2a2 2 0 0 0-2 2v4.9c0 1 .9 2 2 2s2-1 2-2Z" />
        </svg>
        
        <svg
          class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10 opacity-0 dark:opacity-100"
          viewBox="0 0 24 24"
          fill="none"
          height="16"
          width="16">
          <path
            fill="#000"
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M8.2 2.2c1-.4 2 .6 1.6 1.5-1 3-.4 6.4 1.8 8.7a8.4 8.4 0 0 0 8.7 1.8c1-.3 2 .5 1.5 1.5v.1a10.3 10.3 0 0 1-9.4 6.2A10.3 10.3 0 0 1 3.2 6.7c1-2 2.9-3.5 4.9-4.4Z" />
        </svg>
      </span>
    </label>
  </div>

  
  <script>
    var darkMode = true;

    

    if (localStorage.getItem("theme") === "dark"){darkMode = true}
    else if (localStorage.getItem("theme") === "light"){darkMode = false}

    if (darkMode){document.documentElement.classList.add("dark")}
    else {document.documentElement.classList.remove("dark")}

    
    document.addEventListener("DOMContentLoaded", () => {
      var themeSwitch = document.querySelectorAll("[data-theme-switcher]");
      var themeSwitcherContainer = document.querySelector('.theme-switcher');

      [].forEach.call(themeSwitch, function (ts) {
        ts.checked = darkMode;
        ts.addEventListener("click", () => {
          document.documentElement.classList.toggle("dark");
          localStorage.setItem(
            "theme",
            document.documentElement.classList.contains("dark") ? "dark" : "light"
          );
        });
      });

      
      themeSwitcherContainer.classList.remove('hidden');
    });
  </script>




      
      
    </div>
  </nav>
</header>

    




  
    <div
      class="search-modal "
      aria-hidden="true"
      style="--color-primary: #121212">
      <div data-target="close-search-modal" class="search-modal-overlay"></div>
      <div
        class="search-wrapper"
        data-image="true"
        data-description="true"
        data-tags="true"
        data-categories="true">
        <div class="search-wrapper-header">
          <label for="search-modal-input" style="margin-top:-1px">
            <span class="sr-only">search icon</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512 512"
              height="18"
              width="18"
              class="search-icon"
              data-type="search">
              <path
                fill="currentColor"
                d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z" />
            </svg>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512 512"
              height="18"
              width="18"
              class="search-reset"
              data-type="reset">
              <path
                fill="currentColor"
                d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z" />
            </svg>
          </label>
          <input
            id="search-modal-input"
            type="text"
            data-search-input
            autocomplete="off"
            aria-label="Search"
            placeholder="" />
        </div>
        <div class="search-wrapper-body">
          <div class="search-result" data-search-result></div>
          <span class="search-result-empty">
            
          </span>
        </div>
        <div class="search-wrapper-footer">
          <span>
            <kbd>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="14"
                fill="currentColor"
                viewBox="0 0 16 16">
                <path
                  d="M3.204 11h9.592L8 5.519 3.204 11zm-.753-.659 4.796-5.48a1 1 0 0 1 1.506 0l4.796 5.48c.566.647.106 1.659-.753 1.659H3.204a1 1 0 0 1-.753-1.659z" />
              </svg>
            </kbd>
            <kbd>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="14"
                fill="currentColor"
                style="margin-top:1px;"
                viewBox="0 0 16 16">
                <path
                  d="M3.204 5h9.592L8 10.481 3.204 5zm-.753.659 4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659z" />
              </svg>
            </kbd>
            to navigate
          </span>
          <span>
            <kbd>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="12"
                height="12"
                fill="currentColor"
                style="display:inline-block;"
                viewBox="0 0 16 16">
                <path
                  fill-rule="evenodd"
                  d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5z" />
              </svg>
            </kbd>
            to select
          </span>
          <span class="search-result-info"></span>
          <span data-target="close-search-modal">
            <kbd>ESC</kbd> to close
          </span>
        </div>
      </div>
    </div>
  




    <main>
      
  <section>
  <div class="container text-center">
    <div
      class="from-body to-theme-light dark:from-darkmode-body dark:to-darkmode-theme-light rounded-2xl bg-gradient-to-b px-8 py-14">
      <h1>Migración De Aplicaciones Web PHP Al Entorno De Producción</h1>
      




<ul class="mt-6 inline-flex space-x-1 capitalize">
  <li>
    <a class="text-primary dark:text-darkmode-primary" href="//localhost:1313/">
      Home
    </a>
    <span class="inlin-block mr-1">/</span>
  </li>
  
    
  
    
      <li>
        <a
          class="text-primary dark:text-darkmode-primary"
          href="/spanish/">
          
        </a>
        <span class="inlin-block mr-1">/</span>
      </li>
    
  
    
      <li>
        <a
          class="text-primary dark:text-darkmode-primary"
          href="/spanish/blog/">
          Blog de prácticas
        </a>
        <span class="inlin-block mr-1">/</span>
      </li>
    
  
  <li>
    <span class="text-primary dark:text-darkmode-primary">
      Migración de aplicaciones web PHP al entorno de producción
    </span>
  </li>
</ul>

    </div>
  </div>
</section>



  <section class="section-sm">
    <div class="container">
      <div class="row justify-center">
        <div class="lg:col-10">
          <div class="content">
            <p>Este supuesto parte de un servidor Apache2 en un entorno de pruebas con dos aplicaciones PHP instaladas: Moodle y NextCloud. En este post se document la migración de estas aplicaciones a un servidor Nginx en producción.</p>
<h1 id="instalación-del-servidor-lemp-y-de-las-dependencias-de-los-cms">Instalación del servidor LEMP y de las dependencias de los CMS:</h1>
<p>En primer lugar se tienen que instalar en el VPS los paquetes necesarios para configurar el servidor LEMP: <code>nginx</code>, <code>mariadb-server</code> y <code>php</code>.</p>
<p>Además, se instalan otros paquetes que corresponden a las dependencias necesarias para poder instalar en el servidor los CMS de Moodle y NextCloud.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash-session" data-lang="bash-session"><span style="display:flex;"><span>sudo apt install php php-curl php-cli php-mysql php-gd php-gmp libmagickcore-dev php-redis php-memcached php-common php-xml php-json php-intl php-pear php-dev php-common php-mbstring php-zip php-soap php-bz2 php-bcmath php-imagick nginx mariadb-server -y
</span></span></code></pre></div><h1 id="creación-de-los-hosts-virtuales-en-el-vps">Creación de los hosts virtuales en el VPS</h1>
<p>A continuación, se crean los hosts virtuales en el servidor web. En nginx esta configuración se guarda en un fichero con el nombre del virtual host en el directorio /etc/nginx/sites-available. En este fichero se indica el nombre del servidor para cada virtual host, el document root pero también es importante incluir en la lista de documentos de index que el servidor debe buscar el documento index.php que usan los CMS que se están instalando en este caso.</p>
<p>El siguiente documento corresponde al virtual host de Moodle:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">debian@pignite:/etc/nginx/sites-available$</span> <span style="color:#e6db74">cat</span> <span style="color:#e6db74">moodle</span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Virtual Host configuration for www.javihuete.site
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># You can move that to a different file under sites-available/ and symlink that
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># to sites-enabled/ to enable it.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#e6db74">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#e6db74">[::]:80</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">server_name</span> <span style="color:#e6db74">www.javihuete.site</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">root</span> <span style="color:#e6db74">/var/www/moodle</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">index</span> <span style="color:#e6db74">index.php</span> <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span> <span style="color:#e6db74">index.nginx-debian.html</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">try_files</span> $uri $uri/ =<span style="color:#ae81ff">404</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># pass PHP scripts to FastCGI server
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#f92672">location</span> ~ <span style="color:#e6db74">\.php$</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#	include snippets/fastcgi-php.conf;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#75715e"># With php-fpm (or other unix sockets):
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#f92672">fastcgi_pass</span> <span style="color:#e6db74">unix:/run/php/php8.2-fpm.sock</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#	# With php-cgi (or other tcp sockets):
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">#	fastcgi_pass 127.0.0.1:9000;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Y este documento configura el virtual host de NextCloud:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">debian@pignite:/etc/nginx/sites-available$</span> <span style="color:#e6db74">cat</span> <span style="color:#e6db74">nextcloud</span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Virtual Host configuration for cloud.javihuete.site
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># You can move that to a different file under sites-available/ and symlink that
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># to sites-enabled/ to enable it.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#e6db74">server</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#ae81ff">80</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">listen</span> <span style="color:#e6db74">[::]:80</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">server_name</span> <span style="color:#e6db74">cloud.javihuete.site</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">root</span> <span style="color:#e6db74">/var/www/nextcloud</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">index</span> <span style="color:#e6db74">index.php</span> <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span> <span style="color:#e6db74">index.nginx-debian.html</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">try_files</span> $uri $uri/ =<span style="color:#ae81ff">404</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># pass PHP scripts to FastCGI server
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">location</span> ~ <span style="color:#e6db74">\.php$</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">include</span> <span style="color:#e6db74">snippets/fastcgi-php.conf</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#75715e"># With php-fpm (or other unix sockets):
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">fastcgi_pass</span> <span style="color:#e6db74">unix:/run/php/php8.2-fpm.sock</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#       # With php-cgi (or other tcp sockets):
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">#       fastcgi_pass 127.0.0.1:9000;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>En nginx no existe un comando que ponga los virtual host en producción como el comando <code>a2ensite</code> de apache. Para hacerlo, en este caso hay que crear un enlace simbólico al fichero de configuración en el directorio /etc/nginx/sites-enabled de forma manual.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash-session" data-lang="bash-session"><span style="display:flex;"><span>debian@pignite:/etc/nginx/sites-enabled$ sudo ln ../sites-available/moodle 
</span></span><span style="display:flex;"><span>debian@pignite:/etc/nginx/sites-enabled$ sudo ln ../sites-available/nextcloud
</span></span></code></pre></div><h1 id="compresión-de-los-ficheros-de-los-document-root-copia-al-vps-y-descompresión-de-los-ficheros-y-creación-del-document-root">Compresión de los ficheros de los document root, copia al VPS y descompresión de los ficheros y creación del document root</h1>
<p>Para trasladar los contenidos del document root de cada uno de los CMS al VPS, es necesario comprimir los directorios en el servidor de pruebas y copiar el archivo comprimido al VPS.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash-session" data-lang="bash-session"><span style="display:flex;"><span>debian@apache2:/var/www$ zip -r moodle moodle
</span></span><span style="display:flex;"><span>debian@apache2:/var/www$ zip -r nextcloud nextcloud
</span></span><span style="display:flex;"><span>debian@apache2:/var/www$ scp moodle.zip debian@pignite.javihuete.site:/home/debian
</span></span><span style="display:flex;"><span>debian@apache2:/var/www$ scp nextcloud.zip debian@pignite.javihuete.site:/home/debian
</span></span></code></pre></div><p>Después, el contenido del archivo comprimido se extrae y se copia en el document root correspondiente del VPS.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash-session" data-lang="bash-session"><span style="display:flex;"><span>debian@pignite:~$ sudo cp moodle.zip /var/www/
</span></span><span style="display:flex;"><span>debian@pignite:/var/www$ sudo unzip moodle.zip
</span></span><span style="display:flex;"><span>debian@pignite:~$ sudo cp nextcloud.zip /var/www/
</span></span><span style="display:flex;"><span>debian@pignite:/var/www$ sudo unzip nextcloud.zip 
</span></span></code></pre></div><h1 id="creación-de-la-base-de-datos-en-el-vps">Creación de la base de datos en el VPS</h1>
<p>Para que cada CMS pueda acceder a su base de datos correspondiente, se crea una base de datos para cada uno con su correspondiente usuario y contraseña.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mariadb" data-lang="mariadb"><span style="display:flex;"><span>MariaDB [(none)]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> moodle
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-&gt;</span> ;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">001</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [(none)]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;moodle&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;contraseña&#39;</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">001</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [(none)]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> moodle.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;moodle&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;contraseña&#39;</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">001</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [(none)]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">flush</span> <span style="color:#66d9ef">privileges</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">001</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [(none)]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> nextcloud;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">1</span> row <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">001</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [(none)]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;nextcloud&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;contraseña&#39;</span>; 
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">002</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [(none)]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> nextcloud.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;nextcloud&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;contraseña&#39;</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">001</span> sec)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [(none)]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">flush</span> <span style="color:#66d9ef">privileges</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">0</span> rows <span style="color:#a6e22e">affected</span> (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">001</span> sec)
</span></span></code></pre></div><h1 id="realización-del-backup-de-la-base-de-datos-y-copia-al-vps">Realización del backup de la base de datos y copia al VPS</h1>
<p>Para dar contenido a la base de datos creada previamente se crea un copia de la base de datos que está funcionando en el servidor de pruebas y se copia el fichero de respaldo al servidor VPS.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash-session" data-lang="bash-session"><span style="display:flex;"><span>debian@mysql:~$ mysqldump -u moodle -p moodle &gt; moodle.sql
</span></span><span style="display:flex;"><span>debian@mysql:~$ scp moodle.sql debian@pignite.javihuete.site:/home/debian
</span></span><span style="display:flex;"><span>moodle.sql                                   100% 1685KB   3.8MB/s   00:00    
</span></span><span style="display:flex;"><span>debian@mysql:~$ mysqldump -u cloud -p nextcloud &gt; nextcloud.sql
</span></span><span style="display:flex;"><span>Enter password: 
</span></span><span style="display:flex;"><span>debian@mysql:~$ scp nextcloud.sql debian@pignite.javihuete.site:/home/debian
</span></span><span style="display:flex;"><span>nextcloud.sql                                100% 3455KB   4.5MB/s   00:00
</span></span></code></pre></div><p>En el VPS se rellenan las tablas de cada una de las bases de datos a partir del contenido del fichero de respaldo generado en el servidor local.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash-session" data-lang="bash-session"><span style="display:flex;"><span>debian@pignite:~$ mysql -u moodle -p moodle &lt; moodle.sql 
</span></span><span style="display:flex;"><span>Enter password: 
</span></span><span style="display:flex;"><span>debian@pignite:~$ mysql -u nextcloud -p nextcloud &lt; nextcloud.sql 
</span></span><span style="display:flex;"><span>Enter password: 
</span></span></code></pre></div><h1 id="modificación-de-las-credenciales-en-el-fichero-de-configuración-del-cms">Modificación de las credenciales en el fichero de configuración del CMS</h1>
<p>Para que los CMS puedan acceder a la base de datos hay que modificar los ficheros de configuración en los que se hace referencia a la ubicación de la base de datos a la que debe acceder el CMS. En el servidor local, la base de datos estaba en un servidor diferente al servidor web y, por tanto, este dato era la dirección IP del servidor de base de datos. Al pasar al VPS, la base de datos y el servidor web están en el mismo equipo y, por tanto, este campo del fichero de configuración tiene que apuntar al localhost. En estos ficheros de configuración también es necesario indicar correctamente el dominio del VPS, que es diferente al que se ha usado previamente en el servidor local de pruebas.</p>
<p>En Moodle el fichero de configuración está en /var/www/moodle/config.php.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">debian</span><span style="color:#f92672">@</span><span style="color:#a6e22e">pignite</span><span style="color:#f92672">:/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">www</span><span style="color:#960050;background-color:#1e0010">$</span> <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">nano</span> <span style="color:#a6e22e">moodle</span><span style="color:#f92672">/</span><span style="color:#a6e22e">config</span><span style="color:#f92672">.</span><span style="color:#a6e22e">php</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>  <span style="color:#75715e">// Moodle configuration file
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">unset</span>($CFG);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">global</span> $CFG;
</span></span><span style="display:flex;"><span>$CFG <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">stdClass</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$CFG<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">dbtype</span>    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mariadb&#39;</span>;
</span></span><span style="display:flex;"><span>$CFG<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">dblibrary</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;native&#39;</span>;
</span></span><span style="display:flex;"><span>$CFG<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">dbhost</span>    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;localhost&#39;</span>;
</span></span><span style="display:flex;"><span>$CFG<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">dbname</span>    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;moodle&#39;</span>;
</span></span><span style="display:flex;"><span>$CFG<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">dbuser</span>    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;moodle&#39;</span>;
</span></span><span style="display:flex;"><span>$CFG<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">dbpass</span>    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;contraseña&#39;</span>;
</span></span><span style="display:flex;"><span>$CFG<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prefix</span>    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mdl_&#39;</span>;
</span></span><span style="display:flex;"><span>$CFG<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">dboptions</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;dbpersist&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;dbport&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">3306</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;dbsocket&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;dbcollation&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;utf8mb4_general_ci&#39;</span>,
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$CFG<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">wwwroot</span>   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://www.javihuete.site&#39;</span>;
</span></span><span style="display:flex;"><span>$CFG<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">dataroot</span>  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/var/www/moodledata&#39;</span>;
</span></span><span style="display:flex;"><span>$CFG<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">admin</span>     <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;admin&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$CFG<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">directorypermissions</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0777</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">require_once</span>(<span style="color:#66d9ef">__DIR__</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/lib/setup.php&#39;</span>);
</span></span></code></pre></div><p>Y en NextCloud el fichero de configuración está en /var/www/nextcloud/config/config.php</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">debian</span><span style="color:#f92672">@</span><span style="color:#a6e22e">pignite</span><span style="color:#f92672">:/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">www</span><span style="color:#960050;background-color:#1e0010">$</span> <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">nano</span> <span style="color:#a6e22e">nextcloud</span><span style="color:#f92672">/</span><span style="color:#a6e22e">config</span><span style="color:#f92672">/</span><span style="color:#a6e22e">config</span><span style="color:#f92672">.</span><span style="color:#a6e22e">php</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$CONFIG <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;instanceid&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;editado&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;passwordsalt&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;editado&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;secret&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;editado&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;trusted_domains&#39;</span> <span style="color:#f92672">=&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">array</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;cloud.javihuete.site&#39;</span>,
</span></span><span style="display:flex;"><span>  ),
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;datadirectory&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;/var/www/nextcloud/data&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;dbtype&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;mysql&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;version&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;30.0.1.2&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;overwrite.cli.url&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;http://cloud.javihuete.site&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;dbname&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;nextcloud&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;dbhost&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;localhost&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;dbport&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;dbtableprefix&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;oc_&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;mysql.utf8mb4&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;dbuser&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;cloud&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;dbpassword&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;contraseña&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;installed&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>En el caso de Moodle, también es necesario configurar el fichero
/etc/php/8.2/fpm/php.ini para añadir la siguiente línea:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#75715e">; How many GET/POST/COOKIE input variables may be accepted</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">max_input_vars</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">5000</span>
</span></span></code></pre></div><h1 id="registrar-las-nuevas-entradas-del-dns">Registrar las nuevas entradas del DNS</h1>
<p>Finalmente, para que estos servicios sean accesibles desde el exterior, hay que añadir dos registros de tipo CNAME en el DNS que apunten a la máquina en la que están instalados los servidores.</p>
<h1 id="resolución-de-problemas">Resolución de problemas</h1>
<p>En el caso de la instalación de Moodle al no contar con el módulo php de Apache se produce un problema al cargar el CSS de la aplicación.
Esto se debe a que Moodle usa rutas amigables y nginx no está configurado por defecto para interpretar este tipo de url que, en el caso de Moodle, contienen ficheros .php en una parte intermedia de la ruta. Para solucionar el error hay que configurar la conexión con el servidor de aplicaciones en el virtual host de moodle de la siguiente forma:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span>    <span style="color:#66d9ef">location</span> ~ <span style="color:#e6db74">[^/]\.php(/|$)</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">include</span> <span style="color:#e6db74">fastcgi_params</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">fastcgi_split_path_info</span> <span style="color:#e6db74">^(.+\.php)(/.*)</span>$;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">fastcgi_pass</span> <span style="color:#e6db74">unix:/var/run/php/php7.4-fpm.sock</span>; <span style="color:#75715e"># Ajusta la versión de PHP si es diferente
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">fastcgi_index</span> <span style="color:#e6db74">index.php</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">fastcgi_param</span> <span style="color:#e6db74">SCRIPT_FILENAME</span> $document_root$fastcgi_script_name;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">fastcgi_param</span> <span style="color:#e6db74">PATH_INFO</span> $fastcgi_path_info;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>La línea <code>fastcgi_split_path_info ^(.+\.php)(/.*)$;</code> es la que permite que Nginx interprete estas rutas que incluyen una referencia a un fichero .php en mitad de la URL y no sólo al final.</p>
<p>Por su parte, en NextCloud se deben solucionar algunos errores como, por ejemplo, desactivar la opción &ldquo;output_buffering&rdquo; del fichero php.ini, agragar en el fichero de configuración del virtual host la configuración que permite a Nginx interpretar las rutas /.well-known o incluir también en este fichero las líneas que permiten al Nginx servir ficheros .mjs usando MIME.</p>
<p>Además, NextCloud también verifica la integridad de todos los ficheros que conforman la aplicación. De esta manera, si durante la copia desde el servidor local al VPS se ha dejado de copiar algún fichero oculto como el .htaccess o el .user.ini o se ha añadido un nuevo fichero no verificado como el info.php, la aplicación muestra un error. Para resolverlo sólo hay que descargar la misma versión de NextCloud que esté instalada, buscar los ficheros que faltan y colocarlos en el directorio correspondiente. Si algún fichero no está firmado, también se tendrá que eliminar para evitar que se muestre este error.</p>

          </div>
        </div>
      </div>
    </div>
  </section>

    </main>

    
    <footer class="bg-theme-light dark:bg-darkmode-theme-light">
  <div class="container">
    <div class="row items-center py-10">
      <div class="lg:col-3 mb-8 text-center lg:mb-0 lg:text-left">
        
        <a
          class="navbar-brand inline-block"
          href="/">
          















  









  
  
  


  
  
    
    
  


  
  
      
      
    
    
    
    
    
    
  
  

  
  
    
    
      
      


      
      
        
        
        
        

        
        
        
      
      
    
  
  

  
    <img
      fetchpriority="high"
      decoding="async"
      class="img img-light"
      width="160"
      height="32"
      src="/images/logo_hu4114262549785978686.webp"
      alt="Javi Huete"
      onerror="this.onerror=null;this.src='\/images\/logo_hu7137767845088484273.png';" />

    <img
      fetchpriority="high"
      decoding="async"
      class="img img-dark"
      width="160"
      height="32"
      src="/images/logo-darkmode_hu8742296558546396051.webp"
      alt="Javi Huete"
      onerror="this.onerror=null;this.src='\/images\/logo-darkmode_hu4471933895487503573.png';" />
  
  


        </a>
      </div>
      <div class="lg:col-6 mb-8 text-center lg:mb-0">
        <ul>
          
        </ul>
      </div>
      <div class="lg:col-3 mb-8 text-center lg:mb-0 lg:mt-0 lg:text-right">
        <ul class="social-icons">
          
            <li>
              <a
                target="_blank"
                aria-label="email"
                rel="nofollow noopener"
                href="mailto:fjhuete.m@gmail.com">
                <i class="fa-solid fa-envelope"></i>
              </a>
            </li>
          
            <li>
              <a
                target="_blank"
                aria-label="github"
                rel="nofollow noopener"
                href="https://www.github.com/fjhuete">
                <i class="fab fa-github"></i>
              </a>
            </li>
          
            <li>
              <a
                target="_blank"
                aria-label="linkedin"
                rel="nofollow noopener"
                href="https://www.linkedin.com/in/fjhuete">
                <i class="fab fa-linkedin"></i>
              </a>
            </li>
          
            <li>
              <a
                target="_blank"
                aria-label="telegram"
                rel="nofollow noopener"
                href="https://t.me/fj_huete">
                <i class="fab fa-telegram"></i>
              </a>
            </li>
          
        </ul>
      </div>
    </div>
  </div>
  <div class="border-border dark:border-darkmode-border border-t py-7">
    <div class="text-light dark:text-darkmode-light container text-center">
      <p>
        Designed &amp; Developed by <a href="https://zeon.studio"




 target="_blank"
 


>Zeon Studio</a>
      </p>
    </div>
  </div>
</footer>



    
    



  
    
      
    
  

  
    
      
    
  

  
    
      
    
  

  
    
      
    
  

  
    
      
    
  

  
    
      
    
  

  
    
      
    
  

  
    
      
    
  

  
    
      
    
  












<script
  crossorigin="anonymous"
  integrity=""
  src="/js/script.js"></script>


<script
  defer
  async
  crossorigin="anonymous"
  integrity=""
  src="/js/script-lazy.js"></script>



<script>
  if ('serviceWorker' in navigator){navigator.serviceWorker.register("/service-worker.js");}
</script>






  












  



  </body>
</html>
